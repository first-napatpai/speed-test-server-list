<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Test Server URL Data Search</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use the Inter font family for a cleaner look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Use Inter as the default font */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* This is the magic for the responsive "card" layout on mobile.
         It targets screens *smaller* than the 'md' breakpoint (768px).
        */
        @media (max-width: 767px) {
            /* This pseudo-element reads the 'data-label' attribute from the <td>
             and displays it as a label on the left side of the "card".
            */
            tbody td[data-label]::before {
                content: attr(data-label); /* Get text from data-label attribute */
                position: absolute;
                left: 0;
                width: 6.5rem; /* 104px */
                padding-left: 1.5rem; /* Corresponds to px-6 */
                padding-right: 0.5rem;
                text-align: left;
                font-weight: 600; /* semibold */
                color: #4b5563; /* gray-600 */
            }
        }

        /* A little extra style for table row hover on desktop */
        @media (min-width: 768px) {
            tbody tr:hover {
                background-color: #f9fafb; /* Tailwind 'gray-50' */
            }
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white p-6 md:p-8 rounded-lg shadow-md">

        <!-- Header -->
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Speed Test Server URL Data Search</h1>

        <!-- 2. The Search Bar -->
        <div class="mb-6">
            <label for="search-bar" class="block text-sm font-medium text-gray-700 mb-1">Search by Country, Sponsor, Host, or Location:</label>
            <input type="text" id="search-bar" placeholder="e.g., 'United States', 'Sparklight', 'siouxcity'..."
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200">
        </div>

        <!-- Last Updated Timestamp -->
        <div class="mb-6 -mt-2 text-xs text-gray-500 text-right">
            Last updated: <span id="last-updated">10/27/2025, 6:40:55 PM</span>
        </div>

        <!-- 3. The Data Table Container -->
        <!-- This container still handles scrolling on medium-sized screens if needed -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <!-- 
                  The table header is hidden on mobile ('hidden')
                  and shown from 'md' screens up ('md:table-header-group')
                -->
                <thead class="hidden md:table-header-group bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Country</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sponsor</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Location (Name)</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Host</th>
                    </tr>
                </thead>
                <!-- 
                  The table body is set to 'block' on mobile, 
                  and 'table-row-group' on desktop
                -->
                <tbody id="results-body" class="block md:table-row-group divide-y divide-gray-200">
                    <!-- 
                      Updated "Loading" row to be a single block,
                      which works better with the mobile layout.
                    -->
                    <tr>
                        <td class="block md:table-cell px-6 py-4 text-center text-sm text-gray-500" colspan="4">Loading data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <!-- 4. JavaScript for Data and Search -->
    <script>
        // Get references to the HTML elements
        const searchInput = document.getElementById('search-bar');
        const tableBody = document.getElementById('results-body');
        
        // This will hold the data from the JSON file
        let allServerData = [];

        /**
         * Renders the filtered data into the table.
         * @param {Array} data - The array of data objects to render.
         */
        function renderTable(data) {
            // Clear the existing table body
            tableBody.innerHTML = '';

            // If no data matches, show a "not found" message
            if (data.length === 0) {
                // Updated "No results" row to work with mobile layout
                tableBody.innerHTML = `<tr>
                    <td class="block md:table-cell px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" colspan="4">
                        No results found.
                    </td>
                </tr>`;
                return;
            }

            // Loop through the data and create a table row for each item
            data.forEach(item => {
                const row = document.createElement('tr');
                
                // --- CHANGE: Added classes to the <tr> ---
                // On mobile ('block'), it's a card with margin, border, and shadow.
                // On desktop ('md:table-row'), it's a normal table row.
                row.className = 'block md:table-row mb-4 md:mb-0 border border-gray-200 md:border-b md:border-gray-200 rounded-lg md:rounded-none shadow-md md:shadow-none overflow-hidden md:overflow-auto';

                // --- CHANGE: Updated <td> elements ---
                // 1. Removed 'whitespace-nowrap' and added 'whitespace-normal break-words' to allow text wrapping.
                // 2. Added 'data-label' attribute for the mobile CSS pseudo-element.
                // 3. Added responsive classes to stack cells ('block md:table-cell'),
                //    align text ('text-right md:text-left'), and manage padding
                //    for the label ('pl-28 md:pl-6').
                row.innerHTML = `
                    <td class="block md:table-cell text-right md:text-left px-6 py-4 whitespace-normal break-words relative md:static pl-28 md:pl-6 text-sm text-gray-900" data-label="Country">
                        ${item.country || ''}
                    </td>
                    <td class="block md:table-cell text-right md:text-left px-6 py-4 whitespace-normal break-words relative md:static pl-28 md:pl-6 text-sm text-gray-900" data-label="Sponsor">
                        ${item.sponsor || ''}
                    </td>
                    <td class="block md:table-cell text-right md:text-left px-6 py-4 whitespace-normal break-words relative md:static pl-28 md:pl-6 text-sm text-gray-500" data-label="Location">
                        ${item.name || ''}
                    </td>
                    <td class="block md:table-cell text-right md:text-left px-6 py-4 whitespace-normal break-words relative md:static pl-28 md:pl-6 text-sm text-gray-500" data-label="Host">
                        ${item.host || ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        /**
         * Filters the data based on the search term.
         */
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();

            const filteredData = allServerData.filter(item => {
                // Check if the search term is in any of the required fields
                const countryMatch = (item.country || '').toLowerCase().includes(searchTerm);
                const sponsorMatch = (item.sponsor || '').toLowerCase().includes(searchTerm);
                const hostMatch = (item.host || '').toLowerCase().includes(searchTerm);
                const nameMatch = (item.name || '').toLowerCase().includes(searchTerm);
                
                return countryMatch || sponsorMatch || hostMatch || nameMatch;
            });

            // Re-render the table with the filtered data
            renderTable(filteredData);
        }

        // Add an event listener when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch the JSON file from the root of the repository
            fetch('speedtest_servers.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const lastModified = response.headers.get('Last-Modified');
                    const lastUpdatedElement = document.getElementById('last-updated');
                    
                    if (lastUpdatedElement && lastModified) {
                        lastUpdatedElement.textContent = new Date(lastModified).toLocaleString();
                    } else if (lastUpdatedElement) {
                        lastUpdatedElement.textContent = new Date().toLocaleString() + " (page loaded)";
                    }
                    
                    return response.json();
                })
                .then(data => {
                    allServerData = data;
                    renderTable(allServerData);
                    searchInput.addEventListener('input', handleSearch);
                })
                .catch(error => {
                    console.error('Error loading server data:', error);
                    // Updated error message row
                    tableBody.innerHTML = `<tr>
                        <td class="block md:table-cell px-6 py-4 text-sm text-red-600 text-center" colspan="4">
                            <strong>Error:</strong> Could not load 'speedtest_servers.json'.<br>
                            Please make sure the file exists and is valid JSON.
                        </td>
                    </tr>`;
                });
        });

    </script>
</body>
</html>
